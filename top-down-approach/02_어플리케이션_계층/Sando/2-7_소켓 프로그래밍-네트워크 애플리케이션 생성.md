## 목차

[2.7.0 개요](#270-개요) </br> [2.7.1 UDP를 이용한 소켓 프로그래밍](#271-UDP를-이용한-소켓-프로그래밍) </br> [2.7.2 TCP 소켓 프로그래밍](#272-TCP-소켓-프로그래밍) </br>

## 2.7.0 개요

일반적인 네트워크 애플리케이션은 클라이언트-서버 구조를 채액한 프로그램으로 구성되며 이는 두 프로세스가 생성되고 두 프로세스가 소켓으로부터 읽고 쓰기를 통해서 서로 통신한다. 이 절에서는 간단한 UDP 애플리케이션과 TCP 애플리케이션을 통해 UDP와 TCP 소켓 프로그래밍을 소개한다.

## 2.7.1 UDP를 이용한 소켓 프로그래밍

다른 컴퓨터에서 수행되는 프로세스 간의 통신은 소켓에 메시지를 보냄으로써 실행한다고 2.1절에서 언급했다. 각 프로세스는 집과 유사하고 프로세스의 소켓은 문과 유사하다. 애플리케이션은 집의 문 한쪽에 있으며 전송 계층프로토콜은 외부 세계에 있는 문의 다른 쪽에 있다. 애플리케이션 개발자는 소켓의 애플리케이션 계층에 대한 제어권을 갖지만 트랜스포트 계층 쪽에 대한 제어권은 거의 없다.

UDP를 사용할 때 먼저 패킷에 목적지 주소를 붙여 넣어야 한다. 이 패킷이 송신자의 소켓을 통과한 후 인터넷은 이 주소를 이용하여 그 패킷을 인터넷을 통해 수신 프로세스에 있는 소켓으로 라우트한다. 패킷이 수신소켓에 도착하면 수신 프로세스는 소켓을 통해 그 패킷을 추출하고 다음에 피킷의 콘텐츠를 조사하고 적절한 동작을 취한다.

호스트는 하나 혹은 그 이상의 소켓을 갖는 많은 네트워크 애플리케이션 프로세스를 수행하고 있기 대문에 목적지 호스트 내의 특정한 소켓을 식별할 필요가 있다. 소켓이 생성될 때 포트번호라고 하는 식별자가 소켓에 할당되며 따라서 패킷의 목적지 주소는 ip주소와 더불어 소켓의 포트번호도 포함한다.

더 나아가, 송신자의 소스(source)주소—소스 호스트의 IP 주소와 소스 소켓의 포트번호—도 패킷에 붙여진다. 그러나 소스 주소를 패킷에 붙이는 것은 일반적으로 UDP 애플리케이션 코드가 하지 않고 하부 운영체제가 자동으로 실행한다.

## 2.7.2 TCP 소켓 프로그래밍

UDP와 달리 TCP는 연결지향 프로토콜로, 클라이언트와 서버가 서로에게 데이터를 보내기 전에 먼저 TCP 연결을 설정할 필요가 있음을 의미한다. TCP 연결의 한쪽은 클라이언트 소켓에 연결되고 다른 쪽은 서버 소켓에 연결된다. TCP 연결을 생성할 때 클라이언트 소켓 주소(IP주소와 포트번호)와 서버 소켓주소(IP주소와 포트번호)를 연결과 연관시킨다. TCP 연결이 설정된 후 한쪽에서 다른쪽으로 데이터를 보내려면 소켓을 통해 데이터를 TCP 연결로 보내면 된다. 이것이 UDP와 다른부분이며, UDP에서는 서버가 패킷을 소켓에 제공하기 전에 패킷에 목적지 주소를 붙여야 한다.

TCP 서버는 클라이언트가 접속을 시도하기 전에 **서버 프로세스를 먼저 수행하고 있어야 한다.** 또한 서버 프로그램은 임의의 컴퓨터에서 수행되고 있는 **클라이언트로부터의 초기 접속을 처리하는 특별한 출입문(특별한 소켓)을 가져야 한다.** 프로세스/소켓에 대한 집과 출입문의 비유를 이용해서 종종 클라이언트의 초기접속을 ‘출입문을 두드리는 것’으로 표현하기도 한다.

서버 프로세스가 수행되면 클라이언트 프로세스는 서버로의 TCP 연결을 시도한다. 이는 클라이언트 프로그램에서 TCP 소켓을 생성함으로써 가능하다. 클라이언트는 TCP 소켓을 생성할 때 서버에 있는 환영(welcome) 소켓의 주소, 즉 서버의 IP주소와 소켓의 포트번호를 명시한다. 소켓을 생성한 후 클라이언트는 3-way hand-shake를 하고 서버와 TCP 연결을 설정한다. 트랜스포트(전송) 계층에서 일어나는 3-way handshake를 클라이언트와 서버 프로그램은 전혀 인식하지 못한다.

세방향 핸드셰이크 동안 클라이언트 프로세스는 서버 프로세스의 출입문을 두드린다. 서버가 노크를 들으면 서버는 새로운 출입문 즉, **해당 클라이언트에게 지정되는 새로운 소켓을 생성한다.** 애플리케이션 관점에서 볼 때 클라이언트의 소켓과 서버의 연결 소켓은 파이프에 의해 직접 연결된다.
