## 목차

[2.4.0 개요](#240-개요)</br> [2.4.1 DNS가 제공하는 서비스](#241-DNS가-제공하는-서비스)</br> [2.4.2 DNS 동작원리 개요](#242-DNS-동작원리-개요)</br> [2.4.3 DNS레코드와 메시지](#243-DNS레코드와-메시지)</br>

## 2.4.0 개요

호스트에 대한 하나의 식별자는 hostname이다. 호스트네임은 그 호스트의 위치에 대한 정보를 거의 제공하지 않는다. 또한 라우터가 처리하는데 어려움이 있다. 이러한 이유로 호스트는 IP주소로도 식별된다. IP주소는 4바이트로 구성되고 계층구조를 갖는다. 0~255의 십진수로 표현하는 각 바이트는 점으로 구분하며 인터넷의 어디에 위치하는지에 대한 자세한 정보를 얻을 수 있다.

## 2.4.1 DNS가 제공하는 서비스

라우터는 고정길이의 계층구조를 가진 IP주소를 선호하기 때문에 호스트네임을 IP주소로 변환해주는 디렉터리 서비스가 필요하다. 따라서 인터넷 DNS (domain name system)을 사용한다. DNS는 DNS서버들의 계층구조로 구현된 분산 데이터베이스이고 호스트가 분산 데이터베이스로 질의하도록 허락하는 애플리케이션 계층 프로토콜이다. DNS 서버는 주로 BIND (Berkely Internet Name Domain) 소프트웨어를 수행하는 유닉스 컴퓨터이다. DNS 프로토콜은 UDP상에서 수행되고 포트 번호 53을 이용한다. 동작방식은 다음과 같다.

1. 사용자 컴퓨터는 DNS 애플리케이션의 클라이언트 측을 수행한다.
2. 브라우저는 URL로부터 호스트네임을 추출하고 그 hostname을 DNS 애플리케이션 클라이언트 측에 넘긴다.
3. DNS 클라이언트는 DNS 서버로 호스트네임을 포함하는 질의를 보낸다.
4. DNS 클라이언트는 호스트네임에 대한 IP주소를 가진 응답을 받는다.
5. 브라우저가 DNS로부터 IP주소를 받으면, 브라우저는 그 IP주소와 그 주소의 80번 포트에 위치하는 **_HTTP 서버 프로세스로 TCP연결_**을 초기화한다.

DNS는 호스트네임을 IP주소로의 변환 외에 다른 중요한 추가 서비스를 제공한다.

- 호스트 엘리어싱 (host aliasing) 복잡한 호스트 네임을 가진 호스트는 하나 이상의 별명을 가질 수 있다. 호스트의 IP주소뿐만 아니라 별칭 호스트네임에 대한 정식 호스트네임을 얻기 위해 이용될 수 있다.
- 메일 서버 엘리어싱 (mail server aliasing) 호스트의 IP주소뿐만 아니라 별칭 호스트네임에 대한 정식호스트네임을 얻기 위해 메일 애플리케이션에 의해 수행된다.
- 부하 분산 (load distribution) 중복 웹 서버 같은 여러 중복 서버 사이에 부하를 분산하기 위해 사용된다. 각 서버가 다른 종단시스템에서 수행되고 다른 IP주소를 갖는 경우 여러 IP주소가 하나의 정식 호스트네임과 연관되어있다. DNS 데이터베이스는 이 IP주소 집합을 가지고 있고 집합 전체를 가지고 응답한다. 그러나 각 응답에서의 주소는 순환식으로 보낸다. 클라이언트는 대체로 주소집합 내부의 첫번째 IP주소로 HTTP 요청메시지를 보내므로 DNS의 순환방식은 트래픽을 분산하는 효과를 낸다.

## 2.4.2 DNS 동작원리 개요

사용자의 호스트에서 실행되는 어떤 애플리케이션이 호스트네임 → IP주소 변환 요청을 한다. 그 애플리케이션은 변환될 호스트네임을 명시하여 DNS 측의 클라이언트를 호출할 것이다. 그리고 사용자 호스트의 DNS는 네트워크에 질의 메시지를 보낸다. 모든 DNS 질의와 응답 메시지는 포트 53의 UDP 데이터그램으로 보내진다. 약간의 지연 후에 사용자 호스트의 DNS는 요청한 매핑에 해당하는 DNS 응답 메시지를 받는다. 이 매핑은 호출한 애플리케이션으로 보내진다. 이 매커니즘은 전 세계에 분산된 많은 DNS 서버뿐만 아니라 DNS 서버와 질의를 하는 호스트 사이에서의 통신은 애플리케이션 계층 프로토콜로 구성되어있다.

DNS 서버는 단일 중앙 집중 데이터베이스가 아니라 분산되도록 설계되었다. DNS는 분산 데이터베이스가 인터넷에서 어떻게 구현될 수 있는가의 훌륭한 사례이다.

### 분산 계층 데이터베이스

확장성 문제를 위해 DNS는 많은 서버를 이용하고 이들을 계층 형태로 구성하며 전 세계에 분산시킨다. 계층으로 구성된 세 유형의 DNS 서버가 있다. 루트 (root) DNS 서버, 최상위 레벨 도메인 네임 (TLD, top-level domain) DNS 서버, 책임(authoritative) DNS이다.

DNS클라이언트가 호스트네임의 IP주소를 결정하기 원한다고 가정해보면 이 클라이언트는 루트서버 중 하나에 접속한다. 루트서버는 최상위 레벨 도메인 com을 갖는 TLD 서버 IP주소를 보낸다. 그 다음 클라이언트는 이 TLD서버 중 하나에 접속하고 서버는 도메인 amazon.com을 가진 책임 서버의 IP주소를 보낸다. 클라이언트는 amazon.com의 책임 서버 중에서 하나로 접속한다. 서버는 호스트네임 www.amazon.com의 IP주소를 보낸다. 이 DNS 검색 과정을 자세히 살펴보기에 앞서 3가지 DNS에 대해 더 자세히 알아보자.

<center><img src="./2-19.png" width="50%" height="50%"/></center>

- 루트 DNS 서버인터넷에는 400개 이상의 루트 DNS 서버 (A부터 M까지 분류)가 있다. 대부분 북미지역에 위치한다.
- 최상위 레벨 도메인 (TLD) 서버 com, org, net, edu 같은 상위 레벨 도메인과 kr, uk, fr, ca, jp 같은 모든 국가의 상위 레벨 도메인에 대한 TLD 서버(또는 서버 클러스터)가 있다. TLD서버들은 책임 DNS 서버들에 대한 IP주소들을 제공한다.
- 책임 DNS 서버인터넷에서 접근하기 쉬운 호스트(웹 서버와 메일서버)를 가진 모든 기관은 호스트네임을 IP주소로 매핑하는 공개적인 DNS 레코드를 제공해야한다.
- 로컬 DNS 서버서버들의 계층구조에 엄격하게 속하지는 않지만 DNS 구조의 중심에 있다. ISP들은 로컬 DNS 서버 (또는 디폴트 네임서버)를 갖는다. 호스트가 ISP에 연결될 떄 그 ISP는 로컬 DNS 서버로부터 IP주소를 호스트에게 제공한다. 호스트가 DNS 질의를 보내면 이 질의는 먼저 프록시로 동작하는 로컬 DNS 서버에게 전달되고 그 로컬 DNS 서버는 이 질의를 DNS 서버 계층으로 전달한다.

요청 호스트로부터 로컬 DNS 서버까지는 재귀적 질의 recursive query 와 로컬DNS 서버로부터 루트, TLD, 책임 DSN 서버까지는 반복적 질의 iterative query로 이루어진다.

### DNS 캐싱

DNS는 지연 성능 향상과 네트워크의 DNS 메시지 수를 줄이기 위해 캐싱을 사용한다. DNS 서버가 DNS 응답을 받았을 때 로컬 메모리에 응답에 대한 정보를 저장할 수 있다.

## 2.4.3 DNS레코드와 메시지

DNS 분산 데이터베이스를 구현한 DNS 서버들은 호스트네임을 IP주소로 매핑하기 위한 자원 레코드 resource record, RR 을 저장한다. 각 DNS는 하나 이상의 자원레코드를 가진 메시지로 응답한다. 자원 레코드는 다음과 같은 필드를 포함하는 4개틔 튜플로 이루어진다. `(Name, Value, Type, TTL)` TTL은 자원레코드의 생존기간이다. 다음에 주어진 예제 레코드에서 TTL 필드는 무시한다. Name 과 Value의 의미는 Type에 따른다.

- Type=A
  Name은 호스트네임, Value는 호스트네임에 대한 IP주소다. Type A 레코드는 표준 호스트네임의 IP주소 매핑을 제공한다. 예, (relay1.bar.foo.com, 145.37.93.126, A)
- Type=NS
  Name은 도메인이고 Value는 도메인 내부의 호스트에 대한 IP주소를 얻을 수 있는 방법을 아는 책임 DNS 서버의 호스트네임이다. 예, (foo.com, dns.foo.com, NS)
- Type=CNAME
  Value는 별칭 호스트네임 Name에 대한 정식 호스트네임이다. 이 레코드는 질의 호스트에게 호스트 네임에 대한 정식 이름을 제공한다. 예, (foo.com, relay1.bar.foo.com, CNAME)
- Type=MX
  Value는 별칭 호스트 네임 Name을 갖는 메일 서버의 정식 이름이다. MX 레코드는 메일서버의 호스트네임이 간단한 별칭을 갖는 것을 허용한다. 예, (foo.com, mail.bar.foo.com, MX)

### DNS 데이터베이스에 레코드 삽입

처음에 어떻게 레코드를 데이터베이스에 넣는지 알아보자. 처음에 도메인 네임을 등록기관에 등록한다. 등록기관은 도메인 네임의 유일성을 확인하고 그 도메인 이름을 DNS 데이터베이스에 넣고 약간의 요금을 받는다. 도메인 네임을 동록기관에 등록할 때 등록기관에 주책임 서버와 부책임 서버의 이름과 IP주소를 등록기관에 제공해야한다. 그 이름과 IP주소가 dns1.networkutopia.com, dns2.networkutopia.com, 212.212.212.1, 212.212.212.2 라고 하자. 두 책임 DNS 서버에 각각에 대해 등록기관은 Type NS와 Type A 레코드가 TLD com 서버에 등록되도록 확인한다. 자원 레코드가 당신의 책임DNS 서버에 등록되는것을 확인한 후 사람들은 당신의 웹사이트를 방문할 수 있다.
