웹은 온 디멘드 방식으로 사용자가 원하는걸 요청할 때 원하는걸 수신한다. 

## 웹 브라우저와 클라이언트

기본적으로 웹 서버는 웹 객체 데이터를 갖고있다. 

클라이언트는 HTTP 메세지에 객체 데이터에 대한 요청을 보내고 서버는 이를 받으면 HTTP 메세지에 객체 데이터를 담아서 응답으로 보낸다. 

HTTP가 TCP 프로토콜을 무조건 사용한다 그래서 일단 클라이언트는 서버에 TCP와 연결을 한다. 
그럼 클라이언트는 요청 메세지를 소켓 인터페이스를 이용해 서버로 보내고 서버는 응답 메세지를 마찬가지로 소켓 인터페이스를 이용해 보내게 된다. 

#### Stateless 프로토콜

HTTP는 상태를 저장하고 있지 않는다. 그래서 똑같은 요청을 바로
g 보낸다고 해도 서버는 다시 응답 데이터를 보내준다. 

## 비지속 연결 VS 지속 연결

### 1. 비지속 연결

클라이언트와 서버간에 응답 쌍마다 매번 다른 TCP를 연결해 보내는 방식을 의미한다. 

그래서 요청과 응답의 하나의 cycle이 완료가 되면 TCP 연결을 끊는다. 

HTTP 1.0은 이런 비지속 연결만을 지원한다. 3 way handshake를 수행해 데이터를 주고 받으면 즉시 4 handshake를 통해 연결을 바로 끊어버린다. 

하지만 비지속 연결의 단점은 매번 요청마다 2RTT가 소요가 되고 각 객체를 요청할 때마다 새로운 새로운 TCP 연결이되어야 한다. 
그 과정에서 네트워크 리소스의 낭비가 심해진다. (3 way handshake 오버헤드가 많다)

참고로 RTT는 한번 데이터를 주고 받으면 그 사이에 걸리는 시간을 의미한다.

### 2. 지속 연결

지속 연결은 HTTP/1.1 버전부터 나왔다. 
같은 클라이언트와 서버간에 한번 TCP 연결을 하면 끊지않고 통신을 하고 일정시간이 지나고 나서 TCP 연결을 끊는다.

RTT가 일정시간 이상 지나가면 그 때 TCP를 끊는다. 
반대로 응답 받게 되면 0으로 RTT를 초기화한다.

#### 파이프라인

HTTP/1.1에서 지원하기 시작한기능이 파이르라인인데 1.0은 응답을 받아야 다른 요청이 가능했는데 1.1부터는 응답을 받을 때까지 기다리지 않고 또 요청을 보낸다. 병렬적으로 받아오는게 가능하다. 하지만 멀티플랙싱을 지원하지 않기 때문에 파이프라인을 거의 지원하지 않는다. 

브라우저가 TCP 연결을 서버에게 여러개 할 수 있다.

## HTTP 포멧

### HTTP 요청 메세지

GET /somedir/page.html HTTP/1.1
Host: www.someschool.edu
Connection: close
User-agent: Mozilla/5.0
Accept-language: fr

Entity Body

- Host는 객체가 존재하는 주소를 의미한다.
- Connection을 통해 비지속, 지속 연결중에 어떤걸 원하는지 알 수 있다.
- User-agent는 서버에게 요청하는 브라우저의 타입을 명시한다.
- Accept-language는 사용자가 객체의 어떤 언어 버전을 원하는지 알 수 있는 부분이다.

### HTTP 응답 메세지

HTTP/1.1 200 OK
Connection: close
Date: Tue, 18 Aug 2015 15:44:04 GMT
Server: Apache/2.2.3 (CentOS)
Last-Modified: Tue, 18 Aug 2015 15:11:03 GMT
Content-Length: 6821
Content-Type: text/html
(data data data data data ...)

- Connection은 마찬가지로 요청 응답을 완료하고 TCP 연결을 끊을지 결정해주는 옵션이다.
- Date는 HTTP 응답이 서버에 의해 생성되고 보낸 날짜와 시간을 의미한다. 
- Server는 어떤 웹 서버에 의해 만들어지는지 기입된 부분이다.
- Last-Modified는 응답받는 객체의 마지막 수정 날짜를 의미한다.
- Content-Length는 응답 받는 객체의 바이트수를 의미한다.
- Content-Type은 body 부분으로 받는 객체의 타입을 나타낸다. 

## 쿠키

사용자에 따라 다른 컨텐츠를 보여주고 싶거나 제한하고 싶을 때 쿠키를 사용한다. 

## 웹 캐싱

웹 서버에 요청을 보내는게 아닌 앞에 프록시 서버에서 HTTP 요구를 충족시키는걸 의미한다.

하지만 사용자가 데이터를 수정했으면 본서버와 웹 캐싱서버간에 데이터를 동기화 해줘야하는데 조건부 GET을 통해 이 문제를 해결할 수 있다.



#### 프록시 서버 동작 과정

1. 브라우저와 웹 캐시는 서로 TCP 연결을 설정하고 웹 캐시에 있는 객체에게 HTTP 요청을 보낸다.
2. 웹 캐시는 해당 객체를 갖고 있는지 판단하고 갖고 있다면 응답해준다.
3. 갖고 있지 않다면 기존 웹 캐시는 웹 서버와 TCP 연결을 설정해 요청을 한다. 그럼 웹 서버는 웹 캐시로 HTTP 응답 메세지를 보낸다.
4. 그리고 이미 설정된 브라우저와 웹 캐시의 TCP 연결을 통해 객체를 응답해준다. 

참고로 여기서 웹 캐시는 클라이언트이면서 서버의 역할을 한다.

#### 웹 캐시 사용 이유?

1. 클라이언트와 캐시사이에 높은 속도의 연결이 설정 되어져 있기 때문에 빠른 속도로 응답을 해줄 수 있다.
2. 하나의 인터넷에서 접속할 때 웹 서버의 트래픽을 대폭으로 줄여줄 수 있다.

대표적으로 우리가 자주 사용하는 CDN 서버가 웹 캐시에 해당한다. 